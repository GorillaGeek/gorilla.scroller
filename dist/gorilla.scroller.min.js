window.gorilla||(window.gorilla={}),function(e,i){function t(){var i=a.find("section"),t=0;i.each(function(){var n=e(this);n.find("section").size()>0||(h.add(n,t,i.length),t++)}),h[0].active(!0)}function n(){var i,t,n=null;e(window).mousewheel(function(){return clearTimeout(i),t=h.current(),null===n&&(n=t.elem.scrollTop()),event.deltaY>0?void(i=setTimeout(function(){t.hasScroll()&&n!==t.elem.scrollTop()||r(),n=null},f.scrollDelay)):void(i=setTimeout(function(){t.hasScroll()&&n!==t.elem.scrollTop()||l(),n=null},f.scrollDelay))})}function o(){var i=function(){e("body").addClass("gorilla-scroller"),d&&h[0].active(!0),d=!1},t=function(){d=!0,e("body").removeClass("gorilla-scroller")},n=null;e(window).resize(function(){clearTimeout(n),n=setTimeout(function(){return"function"==typeof f.disable?f.disable()?void t():void i():f.disable?void t():void i()},100)}),e(window).trigger("resize")}function r(){var e=h.current();!d&&e.isScrollOnBottom()&&e.next()&&e.active(!1)}function l(){var e=h.current();!d&&e.isScrollOnTop()&&e.prev()&&e.prev().active(!0)}function s(){u=e("<nav class='gorilla-scroller-navigation' />");var i=e("<ul />");h.forEach(function(t){var n=e("<li />"),o=e("<a />");o.attr({section:t.index});var r=t.elem.parents("section");r.size()>0&&r.find("section:first-child")[0]!==t.elem[0]||(n.append(o),i.append(n))}),u.css({"z-index":h.length+f.zIndex+2}),u.append(i),a.append(u),u.on("click","a",function(){h.find(e(this).attr("section")).active(!0)}),setTimeout(function(){u.height(i.height()),c()},0)}function c(){if(u){var e,i=h.current(),t=i.index;do if(e=u.find("[section="+t+"]"),t--,-1>t)throw"Gorilla Scroller: Navigation link not found";while(0===e.size());u.removeClass(function(e,i){return(i.match(/(^|\s)active-\S+/g)||[]).join(" ")}),u.addClass("active-"+i.index),u.find("li").removeClass("active active-sub"),u.find("li").removeClass(function(e,i){return(i.match(/(^|\s)active-\S+/g)||[]).join(" ")});var n="active";i.isChild()&&(n+=" active-sub active-"+i.parentIndex),e.parents("li").addClass(n)}}var a,u,d=!1,f={zIndex:0,scrollDelay:300,showNavigation:!0,disable:!1,callback:function(e,i){}},h=[];h.add=function(e,i,t){h.push(new v(e,i,t-i+f.zIndex))},h.current=function(){return h.filter(function(e){return e.is(a.find(".gorilla-scroller-active").first())})[0]},h.find=function(e){var i=a.find(".gorilla-scroller-section[section="+e+"]");return i.size()?h.filter(function(e){return e.is(i)})[0]:null},Scroller=function(i,t){this.init(e(i),t||{})},i.scroller=Scroller,e.fn.gorillaScroller=function(e){return new i.scroller(this,e)},Scroller.prototype.init=function(i,r){a=i,e.extend(f,r),e("body").addClass("gorilla-scroller"),a.addClass("gorilla-scroller-root"),t(),n(),f.showNavigation&&s(),o()},Scroller.prototype.active=function(e){var i=h.find(e);if(!i)throw"Gorilla Scroller: Section not found";i.active(!0)},Scroller.prototype.disabled=function(){return d};var v=function(e,i,t){this.elem=e,this.index=i,this.parentIndex=0,this.isChild()&&e.parents("section").find(".gorilla-scroller-section").each(function(e,i){return this.is(i)?!1:void this.parentIndex++}.bind(this)),e.addClass("gorilla-scroller-section gorilla-scroller-section-"+i),e.attr("section",i),e.css({"z-index":t})};v.prototype.is=function(i){return this.elem[0]===e(i)[0]},v.prototype.isChild=function(){return this.elem.parents("section").size()>0},v.prototype.hasScroll=function(){return this.elem[0].scrollHeight-this.elem.outerHeight()>0},v.prototype.isScrollOnTop=function(){return!this.hasScroll()||0===this.elem.scrollTop()},v.prototype.isScrollOnBottom=function(){return!this.hasScroll()||this.elem.scrollTop()>=this.elem[0].scrollHeight-this.elem.outerHeight()},v.prototype.active=function(e,i){if(!i)if(e)f.callback("current",{section:this.index,elem:this.elem});else{var t=this.next();f.callback("current",{section:t.index,elem:t.elem})}return e?(this.elem.addClass("gorilla-scroller-active"),this.next()&&this.next().active(!0,!0),!i&&this.prev()&&this.prev().active(!1,!0),void c(this.index)):(this.elem.removeClass("gorilla-scroller-active"),i&&this.prev()&&this.prev().active(!1,!0),void c(this.index))},v.prototype.prev=function(){return h.find(this.index-1)},v.prototype.next=function(){return h.find(this.index+1)}}(jQuery,window.gorilla);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdvcmlsbGEuc2Nyb2xsZXIuanMiXSwibmFtZXMiOlsid2luZG93IiwiZ29yaWxsYSIsIiQiLCJzZWN0aW9uc0NvbmZpZyIsInNlY3Rpb25zRG9tIiwicm9vdCIsImZpbmQiLCJpbmRleCIsImVhY2giLCJzZWN0aW9uIiwidGhpcyIsInNpemUiLCJzZWN0aW9ucyIsImFkZCIsImxlbmd0aCIsImFjdGl2ZSIsImV2ZW50Q29uZmlnIiwidGltZW91dCIsImN1cnJlbnQiLCJpbml0aWFsU2Nyb2xsIiwibW91c2V3aGVlbCIsImNsZWFyVGltZW91dCIsImVsZW0iLCJzY3JvbGxUb3AiLCJldmVudCIsImRlbHRhWSIsInNldFRpbWVvdXQiLCJoYXNTY3JvbGwiLCJzY3JvbGxEb3duIiwic2V0dGluZ3MiLCJzY3JvbGxEZWxheSIsInNjcm9sbFVwIiwiZGlzYWJsZUNvbmZpZyIsImVuYWJsZSIsImFkZENsYXNzIiwiaXNEaXNhYmxlZCIsImRpc2FibGUiLCJyZW1vdmVDbGFzcyIsInRpbWVvdXRSZXNpemUiLCJyZXNpemUiLCJ0cmlnZ2VyIiwiaXNTY3JvbGxPbkJvdHRvbSIsIm5leHQiLCJpc1Njcm9sbE9uVG9wIiwicHJldiIsIm5hdmlnYXRpb25Db25maWciLCJuYXZpZ2F0aW9uIiwidWwiLCJmb3JFYWNoIiwiaXRlbSIsImxpIiwiYSIsImF0dHIiLCJwYXJlbnRTZWN0aW9uIiwicGFyZW50cyIsImFwcGVuZCIsImNzcyIsInotaW5kZXgiLCJ6SW5kZXgiLCJvbiIsImhlaWdodCIsIm5hdmlnYXRpb25DaGFuZ2UiLCJjdXJyZW50TGluayIsIm1hdGNoIiwiam9pbiIsImFjdGl2ZUNsYXNzIiwiaXNDaGlsZCIsInBhcmVudEluZGV4Iiwic2hvd05hdmlnYXRpb24iLCJjYWxsYmFjayIsImRhdGEiLCJ0b3RhbFNlY3Rpb25zIiwicHVzaCIsIlNlY3Rpb24iLCJmaWx0ZXIiLCJpcyIsImZpcnN0IiwiZG9tIiwiU2Nyb2xsZXIiLCJjb25maWciLCJpbml0Iiwic2Nyb2xsZXIiLCJmbiIsImdvcmlsbGFTY3JvbGxlciIsInByb3RvdHlwZSIsImV4dGVuZCIsImRpc2FibGVkIiwiYmluZCIsInNjcm9sbEhlaWdodCIsIm91dGVySGVpZ2h0IiwiYXBwbHlDYXNjYWRlIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQUFBS0EsT0FBT0MsVUFDUkQsT0FBT0MsWUFHWCxTQUFXQyxFQUFHRCxHQXlGVixRQUFTRSxLQUNMLEdBQUlDLEdBQWNDLEVBQUtDLEtBQUssV0FFeEJDLEVBQVEsQ0FDWkgsR0FBWUksS0FBSyxXQUNiLEdBQUlDLEdBQVVQLEVBQUVRLEtBRVpELEdBQVFILEtBQUssV0FBV0ssT0FBUyxJQUlyQ0MsRUFBU0MsSUFBSUosRUFBU0YsRUFBT0gsRUFBWVUsUUFDekNQLE9BR0pLLEVBQVMsR0FBR0csUUFBTyxHQUd2QixRQUFTQyxLQUNMLEdBQUlDLEdBRUFDLEVBQ0FDLEVBQWdCLElBQ3BCakIsR0FBRUYsUUFBUW9CLFdBQVcsV0FRakIsTUFQQUMsY0FBYUosR0FDYkMsRUFBVU4sRUFBU00sVUFFRyxPQUFsQkMsSUFDQUEsRUFBZ0JELEVBQVFJLEtBQUtDLGFBRzdCQyxNQUFNQyxPQUFTLE9BQ2ZSLEVBQVVTLFdBQVcsV0FDWlIsRUFBUVMsYUFBZVIsSUFBa0JELEVBQVFJLEtBQUtDLGFBQ3ZESyxJQUdKVCxFQUFnQixNQUNqQlUsRUFBU0MsbUJBSWhCYixFQUFVUyxXQUFXLFdBQ1pSLEVBQVFTLGFBQWVSLElBQWtCRCxFQUFRSSxLQUFLQyxhQUN2RFEsSUFHSlosRUFBZ0IsTUFDakJVLEVBQVNDLGdCQUlwQixRQUFTRSxLQUNMLEdBQUlDLEdBQVMsV0FDVC9CLEVBQUUsUUFBUWdDLFNBQVMsb0JBRWZDLEdBQ0F2QixFQUFTLEdBQUdHLFFBQU8sR0FHdkJvQixHQUFhLEdBR2JDLEVBQVUsV0FDVkQsR0FBYSxFQUNiakMsRUFBRSxRQUFRbUMsWUFBWSxxQkFHdEJDLEVBQWdCLElBQ3BCcEMsR0FBRUYsUUFBUXVDLE9BQU8sV0FDYmxCLGFBQWFpQixHQUNiQSxFQUFnQlosV0FBVyxXQUN2QixNQUErQixrQkFBcEJHLEdBQVNPLFFBQ1pQLEVBQVNPLGNBQ1RBLFNBSUpILEtBSUNKLEVBQVNPLFlBS2RBLFNBSklILE1BS0wsT0FFUC9CLEVBQUVGLFFBQVF3QyxRQUFRLFVBR3RCLFFBQVNaLEtBQ0wsR0FBSVYsR0FBVU4sRUFBU00sV0FFbkJpQixHQUFlakIsRUFBUXVCLG9CQUF1QnZCLEVBQVF3QixRQUkxRHhCLEVBQVFILFFBQU8sR0FHbkIsUUFBU2dCLEtBQ0wsR0FBSWIsR0FBVU4sRUFBU00sV0FFbkJpQixHQUFlakIsRUFBUXlCLGlCQUFvQnpCLEVBQVEwQixRQUl2RDFCLEVBQVEwQixPQUFPN0IsUUFBTyxHQUcxQixRQUFTOEIsS0FDTEMsRUFBYTVDLEVBQUUsOENBQ2YsSUFBSTZDLEdBQUs3QyxFQUFFLFNBRVhVLEdBQVNvQyxRQUFRLFNBQVVDLEdBQ3ZCLEdBQUlDLEdBQUtoRCxFQUFFLFVBQ1BpRCxFQUFJakQsRUFBRSxRQUVWaUQsR0FBRUMsTUFDRTNDLFFBQVN3QyxFQUFLMUMsT0FHbEIsSUFBSThDLEdBQWdCSixFQUFLM0IsS0FBS2dDLFFBQVEsVUFDbENELEdBQWMxQyxPQUFTLEdBQUswQyxFQUFjL0MsS0FBSyx1QkFBdUIsS0FBTzJDLEVBQUszQixLQUFLLEtBSTNGNEIsRUFBR0ssT0FBT0osR0FDVkosRUFBR1EsT0FBT0wsTUFHZEosRUFBV1UsS0FDUEMsVUFBWTdDLEVBQVNFLE9BQVNlLEVBQVM2QixPQUFVLElBRXJEWixFQUFXUyxPQUFPUixHQUNsQjFDLEVBQUtrRCxPQUFPVCxHQUVaQSxFQUFXYSxHQUFHLFFBQVMsSUFBSyxXQUN4Qi9DLEVBQVNOLEtBQUtKLEVBQUVRLE1BQU0wQyxLQUFLLFlBQVlyQyxRQUFPLEtBR2xEVyxXQUFXLFdBQ1BvQixFQUFXYyxPQUFPYixFQUFHYSxVQUNyQkMsS0FDRCxHQUdQLFFBQVNBLEtBQ0wsR0FBS2YsRUFBTCxDQUVBLEdBQ0lnQixHQURBNUMsRUFBVU4sRUFBU00sVUFFbkJYLEVBQVFXLEVBQVFYLEtBRXBCLEdBSUksSUFIQXVELEVBQWNoQixFQUFXeEMsS0FBSyxZQUFjQyxFQUFRLEtBQ3BEQSxJQUVZLEdBQVJBLEVBQ0EsS0FBTSxvREFFa0IsSUFBdkJ1RCxFQUFZbkQsT0FFckJtQyxHQUFXVCxZQUFZLFNBQVU5QixFQUFPaUQsR0FDcEMsT0FBUUEsRUFBSU8sTUFBTSwwQkFBNEJDLEtBQUssT0FFdkRsQixFQUFXWixTQUFTLFVBQVloQixFQUFRWCxPQUV4Q3VDLEVBQVd4QyxLQUFLLE1BQU0rQixZQUFZLHFCQUNsQ1MsRUFBV3hDLEtBQUssTUFBTStCLFlBQVksU0FBVTlCLEVBQU9pRCxHQUMvQyxPQUFRQSxFQUFJTyxNQUFNLDBCQUE0QkMsS0FBSyxNQUd2RCxJQUFJQyxHQUFjLFFBRWQvQyxHQUFRZ0QsWUFDUkQsR0FBZSxzQkFBd0IvQyxFQUFRaUQsYUFHbkRMLEVBQVlSLFFBQVEsTUFBTXBCLFNBQVMrQixJQTFRdkMsR0FBSTVELEdBQ0F5QyxFQUNBWCxHQUFhLEVBQ2JOLEdBQ0E2QixPQUFRLEVBQ1I1QixZQUFhLElBQ2JzQyxnQkFBZ0IsRUFDaEJoQyxTQUFTLEVBQ1RpQyxTQUFVLFNBQVU3QyxFQUFPOEMsTUFNM0IxRCxJQUVKQSxHQUFTQyxJQUFNLFNBQVVTLEVBQU1mLEVBQU9nRSxHQUNsQzNELEVBQVM0RCxLQUFLLEdBQUlDLEdBQVFuRCxFQUFNZixFQUFPZ0UsRUFBZ0JoRSxFQUFRc0IsRUFBUzZCLFVBRzVFOUMsRUFBU00sUUFBVSxXQUNmLE1BQU9OLEdBQVM4RCxPQUFPLFNBQVV6QixHQUM3QixNQUFPQSxHQUFLMEIsR0FBR3RFLEVBQUtDLEtBQUssNEJBQTRCc0UsV0FDdEQsSUFHUGhFLEVBQVNOLEtBQU8sU0FBVUMsR0FDdEIsR0FBSXNFLEdBQU14RSxFQUFLQyxLQUFLLHFDQUF1Q0MsRUFBUSxJQUVuRSxPQUFLc0UsR0FBSWxFLE9BSUZDLEVBQVM4RCxPQUFPLFNBQVV6QixHQUM3QixNQUFPQSxHQUFLMEIsR0FBR0UsS0FDaEIsR0FMUSxNQVdmQyxTQUFXLFNBQVV4RCxFQUFNeUQsR0FDdkJyRSxLQUFLc0UsS0FBSzlFLEVBQUVvQixHQUFPeUQsUUFHdkI5RSxFQUFRZ0YsU0FBV0gsU0FDbkI1RSxFQUFFZ0YsR0FBR0MsZ0JBQWtCLFNBQVVKLEdBQzdCLE1BQU8sSUFBSTlFLEdBQVFnRixTQUFTdkUsS0FBTXFFLElBR3RDRCxTQUFTTSxVQUFVSixLQUFPLFNBQVUxRCxFQUFNeUQsR0FDdEMxRSxFQUFPaUIsRUFDUHBCLEVBQUVtRixPQUFPeEQsRUFBVWtELEdBRW5CN0UsRUFBRSxRQUFRZ0MsU0FBUyxvQkFDbkI3QixFQUFLNkIsU0FBUyx5QkFFZC9CLElBQ0FhLElBRUlhLEVBQVN1QyxnQkFDVHZCLElBR0piLEtBR0o4QyxTQUFTTSxVQUFVckUsT0FBUyxTQUFVUixHQUNsQyxHQUFJVyxHQUFVTixFQUFTTixLQUFLQyxFQUU1QixLQUFLVyxFQUNELEtBQU0scUNBR1ZBLEdBQVFILFFBQU8sSUFHbkIrRCxTQUFTTSxVQUFVRSxTQUFXLFdBQzFCLE1BQU9uRCxHQW1NWCxJQUFJc0MsR0FBVSxTQUFVbkQsRUFBTWYsRUFBT21ELEdBQ2pDaEQsS0FBS1ksS0FBT0EsRUFDWlosS0FBS0gsTUFBUUEsRUFDYkcsS0FBS3lELFlBQWMsRUFFZnpELEtBQUt3RCxXQUNMNUMsRUFBS2dDLFFBQVEsV0FBV2hELEtBQUssNkJBQTZCRSxLQUFLLFNBQVVELEVBQU9lLEdBQzVFLE1BQUlaLE1BQUtpRSxHQUFHckQsSUFDRCxNQUdYWixNQUFLeUQsZUFDUG9CLEtBQUs3RSxPQUdYWSxFQUFLWSxTQUFTLHFEQUF1RDNCLEdBQ3JFZSxFQUFLOEIsS0FBSyxVQUFXN0MsR0FDckJlLEVBQUtrQyxLQUNEQyxVQUFXQyxJQUluQmUsR0FBUVcsVUFBVVQsR0FBSyxTQUFVckQsR0FDN0IsTUFBT1osTUFBS1ksS0FBSyxLQUFPcEIsRUFBRW9CLEdBQU0sSUFHcENtRCxFQUFRVyxVQUFVbEIsUUFBVSxXQUN4QixNQUFPeEQsTUFBS1ksS0FBS2dDLFFBQVEsV0FBVzNDLE9BQVMsR0FHakQ4RCxFQUFRVyxVQUFVekQsVUFBWSxXQUMxQixNQUFRakIsTUFBS1ksS0FBSyxHQUFHa0UsYUFBZTlFLEtBQUtZLEtBQUttRSxjQUFpQixHQUduRWhCLEVBQVFXLFVBQVV6QyxjQUFnQixXQUM5QixPQUFRakMsS0FBS2lCLGFBQXlDLElBQTFCakIsS0FBS1ksS0FBS0MsYUFHMUNrRCxFQUFRVyxVQUFVM0MsaUJBQW1CLFdBQ2pDLE9BQVEvQixLQUFLaUIsYUFBZWpCLEtBQUtZLEtBQUtDLGFBQWdCYixLQUFLWSxLQUFLLEdBQUdrRSxhQUFlOUUsS0FBS1ksS0FBS21FLGVBR2hHaEIsRUFBUVcsVUFBVXJFLE9BQVMsU0FBVUEsRUFBUTJFLEdBQ3pDLElBQUtBLEVBQ0QsR0FBSTNFLEVBQ0FjLEVBQVN3QyxTQUFTLFdBQWE1RCxRQUFTQyxLQUFLSCxNQUFPZSxLQUFNWixLQUFLWSxXQUM1RCxDQUNILEdBQUlvQixHQUFPaEMsS0FBS2dDLE1BQ2hCYixHQUFTd0MsU0FBUyxXQUFhNUQsUUFBU2lDLEVBQUtuQyxNQUFPZSxLQUFNb0IsRUFBS3BCLE9BSXZFLE1BQUlQLElBQ0FMLEtBQUtZLEtBQUtZLFNBQVMsMkJBRWZ4QixLQUFLZ0MsUUFDTGhDLEtBQUtnQyxPQUFPM0IsUUFBTyxHQUFNLElBR3hCMkUsR0FBZ0JoRixLQUFLa0MsUUFDdEJsQyxLQUFLa0MsT0FBTzdCLFFBQU8sR0FBTyxPQUc5QjhDLEdBQWlCbkQsS0FBS0gsU0FJMUJHLEtBQUtZLEtBQUtlLFlBQVksMkJBQ2xCcUQsR0FBZ0JoRixLQUFLa0MsUUFDckJsQyxLQUFLa0MsT0FBTzdCLFFBQU8sR0FBTyxPQUc5QjhDLEdBQWlCbkQsS0FBS0gsU0FHMUJrRSxFQUFRVyxVQUFVeEMsS0FBTyxXQUNyQixNQUFPaEMsR0FBU04sS0FBS0ksS0FBS0gsTUFBUSxJQUd0Q2tFLEVBQVFXLFVBQVUxQyxLQUFPLFdBQ3JCLE1BQU85QixHQUFTTixLQUFLSSxLQUFLSCxNQUFRLEtBSXZDb0YsT0FBUTNGLE9BQU9DIiwiZmlsZSI6ImdvcmlsbGEuc2Nyb2xsZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaWYgKCF3aW5kb3cuZ29yaWxsYSkge1xyXG4gICAgd2luZG93LmdvcmlsbGEgPSB7fTtcclxufVxuXG4oZnVuY3Rpb24gKCQsIGdvcmlsbGEpIHtcblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0ICogVkFSU1xuXHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIHZhciByb290O1xuICAgIHZhciBuYXZpZ2F0aW9uO1xyXG4gICAgdmFyIGlzRGlzYWJsZWQgPSBmYWxzZTtcbiAgICB2YXIgc2V0dGluZ3MgPSB7XHJcbiAgICAgICAgekluZGV4OiAwLFxuICAgICAgICBzY3JvbGxEZWxheTogMzAwLFxuICAgICAgICBzaG93TmF2aWdhdGlvbjogdHJ1ZSxcbiAgICAgICAgZGlzYWJsZTogZmFsc2UsXHJcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChldmVudCwgZGF0YSkgeyB9XHJcbiAgICB9O1xuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHQgKiBTRUNUSU9OU1xuXHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIHZhciBzZWN0aW9ucyA9IFtdO1xuXG4gICAgc2VjdGlvbnMuYWRkID0gZnVuY3Rpb24gKGVsZW0sIGluZGV4LCB0b3RhbFNlY3Rpb25zKSB7XHJcbiAgICAgICAgc2VjdGlvbnMucHVzaChuZXcgU2VjdGlvbihlbGVtLCBpbmRleCwgdG90YWxTZWN0aW9ucyAtIGluZGV4ICsgc2V0dGluZ3MuekluZGV4KSk7XHJcbiAgICB9O1xuXG4gICAgc2VjdGlvbnMuY3VycmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmlzKHJvb3QuZmluZCgnLmdvcmlsbGEtc2Nyb2xsZXItYWN0aXZlJykuZmlyc3QoKSk7XHJcbiAgICAgICAgfSlbMF07XHJcbiAgICB9O1xuXG4gICAgc2VjdGlvbnMuZmluZCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIHZhciBkb20gPSByb290LmZpbmQoJy5nb3JpbGxhLXNjcm9sbGVyLXNlY3Rpb25bc2VjdGlvbj0nICsgaW5kZXggKyAnXScpO1xuXG4gICAgICAgIGlmICghZG9tLnNpemUoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5pcyhkb20pO1xyXG4gICAgICAgIH0pWzBdO1xyXG4gICAgfTtcblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0ICogRVhQT1JUXG5cdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgU2Nyb2xsZXIgPSBmdW5jdGlvbiAoZWxlbSwgY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5pbml0KCQoZWxlbSksIGNvbmZpZyB8fCB7fSk7XHJcbiAgICB9O1xuXG4gICAgZ29yaWxsYS5zY3JvbGxlciA9IFNjcm9sbGVyO1xuICAgICQuZm4uZ29yaWxsYVNjcm9sbGVyID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgICAgIHJldHVybiBuZXcgZ29yaWxsYS5zY3JvbGxlcih0aGlzLCBjb25maWcpO1xyXG4gICAgfTtcblxuICAgIFNjcm9sbGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGVsZW0sIGNvbmZpZykge1xyXG4gICAgICAgIHJvb3QgPSBlbGVtO1xuICAgICAgICAkLmV4dGVuZChzZXR0aW5ncywgY29uZmlnKTtcblxuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2dvcmlsbGEtc2Nyb2xsZXInKTtcbiAgICAgICAgcm9vdC5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlci1yb290Jyk7XG5cbiAgICAgICAgc2VjdGlvbnNDb25maWcoKTtcbiAgICAgICAgZXZlbnRDb25maWcoKTtcblxuICAgICAgICBpZiAoc2V0dGluZ3Muc2hvd05hdmlnYXRpb24pIHtcclxuICAgICAgICAgICAgbmF2aWdhdGlvbkNvbmZpZygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGlzYWJsZUNvbmZpZygpO1xyXG4gICAgfTtcblxuICAgIFNjcm9sbGVyLnByb3RvdHlwZS5hY3RpdmUgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICB2YXIgY3VycmVudCA9IHNlY3Rpb25zLmZpbmQoaW5kZXgpO1xuXG4gICAgICAgIGlmICghY3VycmVudCkge1xyXG4gICAgICAgICAgICB0aHJvdyBcIkdvcmlsbGEgU2Nyb2xsZXI6IFNlY3Rpb24gbm90IGZvdW5kXCI7XHJcbiAgICAgICAgfVxuXG4gICAgICAgIGN1cnJlbnQuYWN0aXZlKHRydWUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBTY3JvbGxlci5wcm90b3R5cGUuZGlzYWJsZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIGlzRGlzYWJsZWQ7XHJcbiAgICB9O1xuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHQgKiBNRVRIT0RTXG5cdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgZnVuY3Rpb24gc2VjdGlvbnNDb25maWcoKSB7XHJcbiAgICAgICAgdmFyIHNlY3Rpb25zRG9tID0gcm9vdC5maW5kKCdzZWN0aW9uJyk7XG5cbiAgICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgICAgc2VjdGlvbnNEb20uZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBzZWN0aW9uID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgaWYgKHNlY3Rpb24uZmluZCgnc2VjdGlvbicpLnNpemUoKSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWN0aW9ucy5hZGQoc2VjdGlvbiwgaW5kZXgsIHNlY3Rpb25zRG9tLmxlbmd0aCk7XG4gICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNlY3Rpb25zWzBdLmFjdGl2ZSh0cnVlKTtcclxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGV2ZW50Q29uZmlnKCkge1xyXG4gICAgICAgIHZhciB0aW1lb3V0O1xuXG4gICAgICAgIHZhciBjdXJyZW50O1xuICAgICAgICB2YXIgaW5pdGlhbFNjcm9sbCA9IG51bGw7XG4gICAgICAgICQod2luZG93KS5tb3VzZXdoZWVsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgICAgY3VycmVudCA9IHNlY3Rpb25zLmN1cnJlbnQoKTtcblxuICAgICAgICAgICAgaWYgKGluaXRpYWxTY3JvbGwgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxTY3JvbGwgPSBjdXJyZW50LmVsZW0uc2Nyb2xsVG9wKCk7XHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGV2ZW50LmRlbHRhWSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnQuaGFzU2Nyb2xsKCkgfHwgaW5pdGlhbFNjcm9sbCA9PT0gY3VycmVudC5lbGVtLnNjcm9sbFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbERvd24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9LCBzZXR0aW5ncy5zY3JvbGxEZWxheSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudC5oYXNTY3JvbGwoKSB8fCBpbml0aWFsU2Nyb2xsID09PSBjdXJyZW50LmVsZW0uc2Nyb2xsVG9wKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxVcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbCA9IG51bGw7XHJcbiAgICAgICAgICAgIH0sIHNldHRpbmdzLnNjcm9sbERlbGF5KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkaXNhYmxlQ29uZmlnKCkge1xyXG4gICAgICAgIHZhciBlbmFibGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlcicpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzRGlzYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIHNlY3Rpb25zWzBdLmFjdGl2ZSh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaXNEaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBkaXNhYmxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpc0Rpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdnb3JpbGxhLXNjcm9sbGVyJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHRpbWVvdXRSZXNpemUgPSBudWxsO1xyXG4gICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dFJlc2l6ZSk7XHJcbiAgICAgICAgICAgIHRpbWVvdXRSZXNpemUgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0dGluZ3MuZGlzYWJsZSA9PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuZGlzYWJsZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghc2V0dGluZ3MuZGlzYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBkaXNhYmxlKCk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNjcm9sbERvd24oKSB7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBzZWN0aW9ucy5jdXJyZW50KCk7XG5cbiAgICAgICAgaWYgKGlzRGlzYWJsZWQgfHwgIWN1cnJlbnQuaXNTY3JvbGxPbkJvdHRvbSgpIHx8ICFjdXJyZW50Lm5leHQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxuXG4gICAgICAgIGN1cnJlbnQuYWN0aXZlKGZhbHNlKTtcclxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNjcm9sbFVwKCkge1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gc2VjdGlvbnMuY3VycmVudCgpO1xuXG4gICAgICAgIGlmIChpc0Rpc2FibGVkIHx8ICFjdXJyZW50LmlzU2Nyb2xsT25Ub3AoKSB8fCAhY3VycmVudC5wcmV2KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50LnByZXYoKS5hY3RpdmUodHJ1ZSk7XHJcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuYXZpZ2F0aW9uQ29uZmlnKCkge1xyXG4gICAgICAgIG5hdmlnYXRpb24gPSAkKFwiPG5hdiBjbGFzcz0nZ29yaWxsYS1zY3JvbGxlci1uYXZpZ2F0aW9uJyAvPlwiKTtcbiAgICAgICAgdmFyIHVsID0gJChcIjx1bCAvPlwiKTtcblxuICAgICAgICBzZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHZhciBsaSA9ICQoXCI8bGkgLz5cIik7XG4gICAgICAgICAgICB2YXIgYSA9ICQoXCI8YSAvPlwiKTtcblxuICAgICAgICAgICAgYS5hdHRyKHtcclxuICAgICAgICAgICAgICAgIHNlY3Rpb246IGl0ZW0uaW5kZXhcclxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBwYXJlbnRTZWN0aW9uID0gaXRlbS5lbGVtLnBhcmVudHMoJ3NlY3Rpb24nKTtcbiAgICAgICAgICAgIGlmIChwYXJlbnRTZWN0aW9uLnNpemUoKSA+IDAgJiYgcGFyZW50U2VjdGlvbi5maW5kKCdzZWN0aW9uOmZpcnN0LWNoaWxkJylbMF0gIT09IGl0ZW0uZWxlbVswXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxpLmFwcGVuZChhKTtcbiAgICAgICAgICAgIHVsLmFwcGVuZChsaSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5hdmlnYXRpb24uY3NzKHtcclxuICAgICAgICAgICAgJ3otaW5kZXgnOiAoc2VjdGlvbnMubGVuZ3RoICsgc2V0dGluZ3MuekluZGV4KSArIDJcclxuICAgICAgICB9KTtcbiAgICAgICAgbmF2aWdhdGlvbi5hcHBlbmQodWwpO1xuICAgICAgICByb290LmFwcGVuZChuYXZpZ2F0aW9uKTtcblxuICAgICAgICBuYXZpZ2F0aW9uLm9uKCdjbGljaycsICdhJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWN0aW9ucy5maW5kKCQodGhpcykuYXR0cignc2VjdGlvbicpKS5hY3RpdmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIG5hdmlnYXRpb24uaGVpZ2h0KHVsLmhlaWdodCgpKTtcbiAgICAgICAgICAgIG5hdmlnYXRpb25DaGFuZ2UoKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG5hdmlnYXRpb25DaGFuZ2UoKSB7XHJcbiAgICAgICAgaWYgKCFuYXZpZ2F0aW9uKSByZXR1cm47XG5cbiAgICAgICAgdmFyIGN1cnJlbnQgPSBzZWN0aW9ucy5jdXJyZW50KCk7XG4gICAgICAgIHZhciBjdXJyZW50TGluaztcbiAgICAgICAgdmFyIGluZGV4ID0gY3VycmVudC5pbmRleDtcblxuICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRMaW5rID0gbmF2aWdhdGlvbi5maW5kKCdbc2VjdGlvbj0nICsgaW5kZXggKyAnXScpO1xuICAgICAgICAgICAgaW5kZXgtLTtcblxuICAgICAgICAgICAgaWYgKGluZGV4IDwgLTEpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IFwiR29yaWxsYSBTY3JvbGxlcjogTmF2aWdhdGlvbiBsaW5rIG5vdCBmb3VuZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSB3aGlsZSAoY3VycmVudExpbmsuc2l6ZSgpID09PSAwKTtcblxuICAgICAgICBuYXZpZ2F0aW9uLnJlbW92ZUNsYXNzKGZ1bmN0aW9uIChpbmRleCwgY3NzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoY3NzLm1hdGNoKC8oXnxcXHMpYWN0aXZlLVxcUysvZykgfHwgW10pLmpvaW4oJyAnKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBuYXZpZ2F0aW9uLmFkZENsYXNzKFwiYWN0aXZlLVwiICsgY3VycmVudC5pbmRleCk7XG5cbiAgICAgICAgbmF2aWdhdGlvbi5maW5kKCdsaScpLnJlbW92ZUNsYXNzKFwiYWN0aXZlIGFjdGl2ZS1zdWJcIik7XG4gICAgICAgIG5hdmlnYXRpb24uZmluZCgnbGknKS5yZW1vdmVDbGFzcyhmdW5jdGlvbiAoaW5kZXgsIGNzcykge1xyXG4gICAgICAgICAgICByZXR1cm4gKGNzcy5tYXRjaCgvKF58XFxzKWFjdGl2ZS1cXFMrL2cpIHx8IFtdKS5qb2luKCcgJyk7XHJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGFjdGl2ZUNsYXNzID0gXCJhY3RpdmVcIjtcblxuICAgICAgICBpZiAoY3VycmVudC5pc0NoaWxkKCkpIHtcclxuICAgICAgICAgICAgYWN0aXZlQ2xhc3MgKz0gXCIgYWN0aXZlLXN1YiBhY3RpdmUtXCIgKyBjdXJyZW50LnBhcmVudEluZGV4O1xyXG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50TGluay5wYXJlbnRzKCdsaScpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICAgIH1cblxuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHQgKiBTRUNUSU9OU1xuXHQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIHZhciBTZWN0aW9uID0gZnVuY3Rpb24gKGVsZW0sIGluZGV4LCB6SW5kZXgpIHtcclxuICAgICAgICB0aGlzLmVsZW0gPSBlbGVtO1xuICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7XG4gICAgICAgIHRoaXMucGFyZW50SW5kZXggPSAwO1xuXG4gICAgICAgIGlmICh0aGlzLmlzQ2hpbGQoKSkge1xyXG4gICAgICAgICAgICBlbGVtLnBhcmVudHMoJ3NlY3Rpb24nKS5maW5kKCcuZ29yaWxsYS1zY3JvbGxlci1zZWN0aW9uJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW0pIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzKGVsZW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRJbmRleCsrO1xyXG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xyXG4gICAgICAgIH1cblxuICAgICAgICBlbGVtLmFkZENsYXNzKCdnb3JpbGxhLXNjcm9sbGVyLXNlY3Rpb24gZ29yaWxsYS1zY3JvbGxlci1zZWN0aW9uLScgKyBpbmRleCk7XG4gICAgICAgIGVsZW0uYXR0cignc2VjdGlvbicsIGluZGV4KTtcbiAgICAgICAgZWxlbS5jc3Moe1xyXG4gICAgICAgICAgICAnei1pbmRleCc6IHpJbmRleFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcblxuICAgIFNlY3Rpb24ucHJvdG90eXBlLmlzID0gZnVuY3Rpb24gKGVsZW0pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtWzBdID09PSAkKGVsZW0pWzBdO1xyXG4gICAgfTtcblxuICAgIFNlY3Rpb24ucHJvdG90eXBlLmlzQ2hpbGQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbS5wYXJlbnRzKCdzZWN0aW9uJykuc2l6ZSgpID4gMDtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5oYXNTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLmVsZW1bMF0uc2Nyb2xsSGVpZ2h0IC0gdGhpcy5lbGVtLm91dGVySGVpZ2h0KCkpID4gMDtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5pc1Njcm9sbE9uVG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiAhdGhpcy5oYXNTY3JvbGwoKSB8fCB0aGlzLmVsZW0uc2Nyb2xsVG9wKCkgPT09IDA7XHJcbiAgICB9O1xuXG4gICAgU2VjdGlvbi5wcm90b3R5cGUuaXNTY3JvbGxPbkJvdHRvbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuaGFzU2Nyb2xsKCkgfHwgdGhpcy5lbGVtLnNjcm9sbFRvcCgpID49ICh0aGlzLmVsZW1bMF0uc2Nyb2xsSGVpZ2h0IC0gdGhpcy5lbGVtLm91dGVySGVpZ2h0KCkpO1xyXG4gICAgfTtcblxuICAgIFNlY3Rpb24ucHJvdG90eXBlLmFjdGl2ZSA9IGZ1bmN0aW9uIChhY3RpdmUsIGFwcGx5Q2FzY2FkZSkge1xyXG4gICAgICAgIGlmICghYXBwbHlDYXNjYWRlKSB7XHJcbiAgICAgICAgICAgIGlmIChhY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKFwiY3VycmVudFwiLCB7IHNlY3Rpb246IHRoaXMuaW5kZXgsIGVsZW06IHRoaXMuZWxlbSB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gdGhpcy5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhcImN1cnJlbnRcIiwgeyBzZWN0aW9uOiBuZXh0LmluZGV4LCBlbGVtOiBuZXh0LmVsZW0gfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtLmFkZENsYXNzKCdnb3JpbGxhLXNjcm9sbGVyLWFjdGl2ZScpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5uZXh0KCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpLmFjdGl2ZSh0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWFwcGx5Q2FzY2FkZSAmJiB0aGlzLnByZXYoKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2KCkuYWN0aXZlKGZhbHNlLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBuYXZpZ2F0aW9uQ2hhbmdlKHRoaXMuaW5kZXgpO1xuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsZW0ucmVtb3ZlQ2xhc3MoJ2dvcmlsbGEtc2Nyb2xsZXItYWN0aXZlJyk7XG4gICAgICAgIGlmIChhcHBseUNhc2NhZGUgJiYgdGhpcy5wcmV2KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5wcmV2KCkuYWN0aXZlKGZhbHNlLCB0cnVlKTtcclxuICAgICAgICB9XG5cbiAgICAgICAgbmF2aWdhdGlvbkNoYW5nZSh0aGlzLmluZGV4KTtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBzZWN0aW9ucy5maW5kKHRoaXMuaW5kZXggLSAxKTtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBzZWN0aW9ucy5maW5kKHRoaXMuaW5kZXggKyAxKTtcclxuICAgIH07XHJcblxuXG59KShqUXVlcnksIHdpbmRvdy5nb3JpbGxhKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
