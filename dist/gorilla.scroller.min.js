window.gorilla||(window.gorilla={}),function(i,e){function t(){var e=a.find("section"),t=0;e.each(function(){var n=i(this);n.find("section").size()>0||(h.add(n,t,e.length),t++)}),h[0].active(!0)}function n(){var e,t,n=null;i(window).mousewheel(function(i){return clearTimeout(e),t=h.current(),null===n&&(n=t.elem.scrollTop()),i.deltaY<0?void(e=setTimeout(function(){t.hasScroll()&&n!==t.elem.scrollTop()||r(),n=null},f.scrollDelay)):void(e=setTimeout(function(){t.hasScroll()&&n!==t.elem.scrollTop()||l(),n=null},f.scrollDelay))})}function o(){var e=function(){i("body").addClass("gorilla-scroller"),d&&h[0].active(!0),d=!1},t=function(){d=!0,i("body").removeClass("gorilla-scroller")},n=null;i(window).resize(function(){clearTimeout(n),n=setTimeout(function(){return"function"==typeof f.disable?f.disable()?void t():void e():f.disable?void t():void e()},100)}),i(window).trigger("resize")}function r(){var i=h.current();!d&&i.isScrollOnBottom()&&i.next()&&i.active(!1)}function l(){var i=h.current();!d&&i.isScrollOnTop()&&i.prev()&&i.prev().active(!0)}function s(){u=i("<nav class='gorilla-scroller-navigation' />");var e=i("<ul />");h.forEach(function(t){var n=i("<li />"),o=i("<a />");o.attr({section:t.index});var r=t.elem.parents("section");r.size()>0&&r.find("section:first-child")[0]!==t.elem[0]||(n.append(o),e.append(n))}),u.css({"z-index":h.length+f.zIndex+2}),u.append(e),a.append(u),u.on("click","a",function(){h.find(i(this).attr("section")).active(!0)}),setTimeout(function(){u.height(e.height()),c()},0)}function c(){if(u){var i,e=h.current(),t=e.index;do if(i=u.find("[section="+t+"]"),t--,-1>t)throw"Gorilla Scroller: Navigation link not found";while(0===i.size());u.removeClass(function(i,e){return(e.match(/(^|\s)active-\S+/g)||[]).join(" ")}),u.addClass("active-"+e.index),u.find("li").removeClass("active active-sub"),u.find("li").removeClass(function(i,e){return(e.match(/(^|\s)active-\S+/g)||[]).join(" ")});var n="active";e.isChild()&&(n+=" active-sub active-"+e.parentIndex),i.parents("li").addClass(n)}}var a,u,d=!1,f={zIndex:0,scrollDelay:300,showNavigation:!0,disable:!1,callback:function(i,e){}},h=[];h.add=function(i,e,t){h.push(new v(i,e,t-e+f.zIndex))},h.current=function(){return h.filter(function(i){return i.is(a.find(".gorilla-scroller-active").first())})[0]},h.find=function(i){var e=a.find(".gorilla-scroller-section[section="+i+"]");return e.size()?h.filter(function(i){return i.is(e)})[0]:null},Scroller=function(e,t){this.init(i(e),t||{})},e.scroller=Scroller,i.fn.gorillaScroller=function(i){return new e.scroller(this,i)},Scroller.prototype.init=function(e,r){a=e,i.extend(f,r),i("body").addClass("gorilla-scroller"),a.addClass("gorilla-scroller-root"),t(),n(),f.showNavigation&&s(),o()},Scroller.prototype.active=function(i){var e=h.find(i);if(!e)throw"Gorilla Scroller: Section not found";e.active(!0)},Scroller.prototype.disabled=function(){return d};var v=function(i,e,t){this.elem=i,this.index=e,this.parentIndex=0,this.isChild()&&i.parents("section").find(".gorilla-scroller-section").each(function(i,e){return this.is(e)?!1:void this.parentIndex++}.bind(this)),i.addClass("gorilla-scroller-section gorilla-scroller-section-"+e),i.attr("section",e),i.css({"z-index":t})};v.prototype.is=function(e){return this.elem[0]===i(e)[0]},v.prototype.isChild=function(){return this.elem.parents("section").size()>0},v.prototype.hasScroll=function(){return this.elem[0].scrollHeight-this.elem.outerHeight()>0},v.prototype.isScrollOnTop=function(){return!this.hasScroll()||0===this.elem.scrollTop()},v.prototype.isScrollOnBottom=function(){return!this.hasScroll()||this.elem.scrollTop()>=this.elem[0].scrollHeight-this.elem.outerHeight()},v.prototype.active=function(i,e){if(!e)if(i)f.callback("current",{section:this.index,elem:this.elem});else{var t=this.next();f.callback("current",{section:t.index,elem:t.elem})}return i?(this.elem.addClass("gorilla-scroller-active"),this.next()&&this.next().active(!0,!0),!e&&this.prev()&&this.prev().active(!1,!0),void c(this.index)):(this.elem.removeClass("gorilla-scroller-active"),e&&this.prev()&&this.prev().active(!1,!0),void c(this.index))},v.prototype.prev=function(){return h.find(this.index-1)},v.prototype.next=function(){return h.find(this.index+1)}}(jQuery,window.gorilla);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdvcmlsbGEuc2Nyb2xsZXIuanMiXSwibmFtZXMiOlsid2luZG93IiwiZ29yaWxsYSIsIiQiLCJzZWN0aW9uc0NvbmZpZyIsInNlY3Rpb25zRG9tIiwicm9vdCIsImZpbmQiLCJpbmRleCIsImVhY2giLCJzZWN0aW9uIiwidGhpcyIsInNpemUiLCJzZWN0aW9ucyIsImFkZCIsImxlbmd0aCIsImFjdGl2ZSIsImV2ZW50Q29uZmlnIiwidGltZW91dCIsImN1cnJlbnQiLCJpbml0aWFsU2Nyb2xsIiwibW91c2V3aGVlbCIsImV2ZW50IiwiY2xlYXJUaW1lb3V0IiwiZWxlbSIsInNjcm9sbFRvcCIsImRlbHRhWSIsInNldFRpbWVvdXQiLCJoYXNTY3JvbGwiLCJzY3JvbGxEb3duIiwic2V0dGluZ3MiLCJzY3JvbGxEZWxheSIsInNjcm9sbFVwIiwiZGlzYWJsZUNvbmZpZyIsImVuYWJsZSIsImFkZENsYXNzIiwiaXNEaXNhYmxlZCIsImRpc2FibGUiLCJyZW1vdmVDbGFzcyIsInRpbWVvdXRSZXNpemUiLCJyZXNpemUiLCJ0cmlnZ2VyIiwiaXNTY3JvbGxPbkJvdHRvbSIsIm5leHQiLCJpc1Njcm9sbE9uVG9wIiwicHJldiIsIm5hdmlnYXRpb25Db25maWciLCJuYXZpZ2F0aW9uIiwidWwiLCJmb3JFYWNoIiwiaXRlbSIsImxpIiwiYSIsImF0dHIiLCJwYXJlbnRTZWN0aW9uIiwicGFyZW50cyIsImFwcGVuZCIsImNzcyIsInotaW5kZXgiLCJ6SW5kZXgiLCJvbiIsImhlaWdodCIsIm5hdmlnYXRpb25DaGFuZ2UiLCJjdXJyZW50TGluayIsIm1hdGNoIiwiam9pbiIsImFjdGl2ZUNsYXNzIiwiaXNDaGlsZCIsInBhcmVudEluZGV4Iiwic2hvd05hdmlnYXRpb24iLCJjYWxsYmFjayIsImRhdGEiLCJ0b3RhbFNlY3Rpb25zIiwicHVzaCIsIlNlY3Rpb24iLCJmaWx0ZXIiLCJpcyIsImZpcnN0IiwiZG9tIiwiU2Nyb2xsZXIiLCJjb25maWciLCJpbml0Iiwic2Nyb2xsZXIiLCJmbiIsImdvcmlsbGFTY3JvbGxlciIsInByb3RvdHlwZSIsImV4dGVuZCIsImRpc2FibGVkIiwiYmluZCIsInNjcm9sbEhlaWdodCIsIm91dGVySGVpZ2h0IiwiYXBwbHlDYXNjYWRlIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQUFBS0EsT0FBT0MsVUFDUkQsT0FBT0MsWUFHWCxTQUFXQyxFQUFHRCxHQXdGVixRQUFTRSxLQUNMLEdBQUlDLEdBQWNDLEVBQUtDLEtBQUssV0FFeEJDLEVBQVEsQ0FDWkgsR0FBWUksS0FBSyxXQUNiLEdBQUlDLEdBQVVQLEVBQUVRLEtBRVpELEdBQVFILEtBQUssV0FBV0ssT0FBUyxJQUlyQ0MsRUFBU0MsSUFBSUosRUFBU0YsRUFBT0gsRUFBWVUsUUFDekNQLE9BR0pLLEVBQVMsR0FBR0csUUFBTyxHQUd2QixRQUFTQyxLQUNMLEdBQUlDLEdBRUFDLEVBQ0FDLEVBQWdCLElBQ3BCakIsR0FBRUYsUUFBUW9CLFdBQVcsU0FBVUMsR0FRM0IsTUFQQUMsY0FBYUwsR0FDYkMsRUFBVU4sRUFBU00sVUFFRyxPQUFsQkMsSUFDQUEsRUFBZ0JELEVBQVFLLEtBQUtDLGFBRzdCSCxFQUFNSSxPQUFTLE9BQ2ZSLEVBQVVTLFdBQVcsV0FDWlIsRUFBUVMsYUFBZVIsSUFBa0JELEVBQVFLLEtBQUtDLGFBQ3ZESSxJQUdKVCxFQUFnQixNQUNqQlUsRUFBU0MsbUJBSWhCYixFQUFVUyxXQUFXLFdBQ1pSLEVBQVFTLGFBQWVSLElBQWtCRCxFQUFRSyxLQUFLQyxhQUN2RE8sSUFHSlosRUFBZ0IsTUFDakJVLEVBQVNDLGdCQUlwQixRQUFTRSxLQUNMLEdBQUlDLEdBQVMsV0FDVC9CLEVBQUUsUUFBUWdDLFNBQVMsb0JBRWZDLEdBQ0F2QixFQUFTLEdBQUdHLFFBQU8sR0FHdkJvQixHQUFhLEdBR2JDLEVBQVUsV0FDVkQsR0FBYSxFQUNiakMsRUFBRSxRQUFRbUMsWUFBWSxxQkFHdEJDLEVBQWdCLElBQ3BCcEMsR0FBRUYsUUFBUXVDLE9BQU8sV0FDYmpCLGFBQWFnQixHQUNiQSxFQUFnQlosV0FBVyxXQUN2QixNQUErQixrQkFBcEJHLEdBQVNPLFFBQ1pQLEVBQVNPLGNBQ1RBLFNBSUpILEtBSUNKLEVBQVNPLFlBS2RBLFNBSklILE1BS0wsT0FFUC9CLEVBQUVGLFFBQVF3QyxRQUFRLFVBR3RCLFFBQVNaLEtBQ0wsR0FBSVYsR0FBVU4sRUFBU00sV0FFbkJpQixHQUFlakIsRUFBUXVCLG9CQUF1QnZCLEVBQVF3QixRQUkxRHhCLEVBQVFILFFBQU8sR0FHbkIsUUFBU2dCLEtBQ0wsR0FBSWIsR0FBVU4sRUFBU00sV0FFbkJpQixHQUFlakIsRUFBUXlCLGlCQUFvQnpCLEVBQVEwQixRQUl2RDFCLEVBQVEwQixPQUFPN0IsUUFBTyxHQUcxQixRQUFTOEIsS0FDTEMsRUFBYTVDLEVBQUUsOENBQ2YsSUFBSTZDLEdBQUs3QyxFQUFFLFNBRVhVLEdBQVNvQyxRQUFRLFNBQVVDLEdBQ3ZCLEdBQUlDLEdBQUtoRCxFQUFFLFVBQ1BpRCxFQUFJakQsRUFBRSxRQUVWaUQsR0FBRUMsTUFDRTNDLFFBQVN3QyxFQUFLMUMsT0FHbEIsSUFBSThDLEdBQWdCSixFQUFLMUIsS0FBSytCLFFBQVEsVUFDbENELEdBQWMxQyxPQUFTLEdBQUswQyxFQUFjL0MsS0FBSyx1QkFBdUIsS0FBTzJDLEVBQUsxQixLQUFLLEtBSTNGMkIsRUFBR0ssT0FBT0osR0FDVkosRUFBR1EsT0FBT0wsTUFHZEosRUFBV1UsS0FDUEMsVUFBWTdDLEVBQVNFLE9BQVNlLEVBQVM2QixPQUFVLElBRXJEWixFQUFXUyxPQUFPUixHQUNsQjFDLEVBQUtrRCxPQUFPVCxHQUVaQSxFQUFXYSxHQUFHLFFBQVMsSUFBSyxXQUN4Qi9DLEVBQVNOLEtBQUtKLEVBQUVRLE1BQU0wQyxLQUFLLFlBQVlyQyxRQUFPLEtBR2xEVyxXQUFXLFdBQ1BvQixFQUFXYyxPQUFPYixFQUFHYSxVQUNyQkMsS0FDRCxHQUdQLFFBQVNBLEtBQ0wsR0FBS2YsRUFBTCxDQUVBLEdBQ0lnQixHQURBNUMsRUFBVU4sRUFBU00sVUFFbkJYLEVBQVFXLEVBQVFYLEtBRXBCLEdBSUksSUFIQXVELEVBQWNoQixFQUFXeEMsS0FBSyxZQUFjQyxFQUFRLEtBQ3BEQSxJQUVZLEdBQVJBLEVBQ0EsS0FBTSxvREFFa0IsSUFBdkJ1RCxFQUFZbkQsT0FFckJtQyxHQUFXVCxZQUFZLFNBQVU5QixFQUFPaUQsR0FDcEMsT0FBUUEsRUFBSU8sTUFBTSwwQkFBNEJDLEtBQUssT0FFdkRsQixFQUFXWixTQUFTLFVBQVloQixFQUFRWCxPQUV4Q3VDLEVBQVd4QyxLQUFLLE1BQU0rQixZQUFZLHFCQUNsQ1MsRUFBV3hDLEtBQUssTUFBTStCLFlBQVksU0FBVTlCLEVBQU9pRCxHQUMvQyxPQUFRQSxFQUFJTyxNQUFNLDBCQUE0QkMsS0FBSyxNQUd2RCxJQUFJQyxHQUFjLFFBRWQvQyxHQUFRZ0QsWUFDUkQsR0FBZSxzQkFBd0IvQyxFQUFRaUQsYUFHbkRMLEVBQVlSLFFBQVEsTUFBTXBCLFNBQVMrQixJQTFRdkMsR0FBSTVELEdBQ0F5QyxFQUNBWCxHQUFhLEVBQ2JOLEdBQ0E2QixPQUFRLEVBQ1I1QixZQUFhLElBQ2JzQyxnQkFBZ0IsRUFDaEJoQyxTQUFTLEVBQ1RpQyxTQUFVLFNBQVVoRCxFQUFPaUQsTUFNM0IxRCxJQUVKQSxHQUFTQyxJQUFNLFNBQVVVLEVBQU1oQixFQUFPZ0UsR0FDbEMzRCxFQUFTNEQsS0FBSyxHQUFJQyxHQUFRbEQsRUFBTWhCLEVBQU9nRSxFQUFnQmhFLEVBQVFzQixFQUFTNkIsVUFHNUU5QyxFQUFTTSxRQUFVLFdBQ2YsTUFBT04sR0FBUzhELE9BQU8sU0FBVXpCLEdBQzdCLE1BQU9BLEdBQUswQixHQUFHdEUsRUFBS0MsS0FBSyw0QkFBNEJzRSxXQUN0RCxJQUdQaEUsRUFBU04sS0FBTyxTQUFVQyxHQUN0QixHQUFJc0UsR0FBTXhFLEVBQUtDLEtBQUsscUNBQXVDQyxFQUFRLElBRW5FLE9BQUtzRSxHQUFJbEUsT0FJRkMsRUFBUzhELE9BQU8sU0FBVXpCLEdBQzdCLE1BQU9BLEdBQUswQixHQUFHRSxLQUNoQixHQUxRLE1BV2ZDLFNBQVcsU0FBVXZELEVBQU13RCxHQUN2QnJFLEtBQUtzRSxLQUFLOUUsRUFBRXFCLEdBQU93RCxRQUd2QjlFLEVBQVFnRixTQUFXSCxTQUNuQjVFLEVBQUVnRixHQUFHQyxnQkFBa0IsU0FBVUosR0FDN0IsTUFBTyxJQUFJOUUsR0FBUWdGLFNBQVN2RSxLQUFNcUUsSUFHdENELFNBQVNNLFVBQVVKLEtBQU8sU0FBVXpELEVBQU13RCxHQUN0QzFFLEVBQU9rQixFQUNQckIsRUFBRW1GLE9BQU94RCxFQUFVa0QsR0FFbkI3RSxFQUFFLFFBQVFnQyxTQUFTLG9CQUNuQjdCLEVBQUs2QixTQUFTLHlCQUVkL0IsSUFDQWEsSUFFSWEsRUFBU3VDLGdCQUNUdkIsSUFHSmIsS0FHSjhDLFNBQVNNLFVBQVVyRSxPQUFTLFNBQVVSLEdBQ2xDLEdBQUlXLEdBQVVOLEVBQVNOLEtBQUtDLEVBRTVCLEtBQUtXLEVBQ0QsS0FBTSxxQ0FHVkEsR0FBUUgsUUFBTyxJQUduQitELFNBQVNNLFVBQVVFLFNBQVcsV0FDMUIsTUFBT25ELEdBbU1YLElBQUlzQyxHQUFVLFNBQVVsRCxFQUFNaEIsRUFBT21ELEdBQ2pDaEQsS0FBS2EsS0FBT0EsRUFDWmIsS0FBS0gsTUFBUUEsRUFDYkcsS0FBS3lELFlBQWMsRUFFZnpELEtBQUt3RCxXQUNMM0MsRUFBSytCLFFBQVEsV0FBV2hELEtBQUssNkJBQTZCRSxLQUFLLFNBQVVELEVBQU9nQixHQUM1RSxNQUFJYixNQUFLaUUsR0FBR3BELElBQ0QsTUFHWGIsTUFBS3lELGVBQ1BvQixLQUFLN0UsT0FHWGEsRUFBS1csU0FBUyxxREFBdUQzQixHQUNyRWdCLEVBQUs2QixLQUFLLFVBQVc3QyxHQUNyQmdCLEVBQUtpQyxLQUNEQyxVQUFXQyxJQUluQmUsR0FBUVcsVUFBVVQsR0FBSyxTQUFVcEQsR0FDN0IsTUFBT2IsTUFBS2EsS0FBSyxLQUFPckIsRUFBRXFCLEdBQU0sSUFHcENrRCxFQUFRVyxVQUFVbEIsUUFBVSxXQUN4QixNQUFPeEQsTUFBS2EsS0FBSytCLFFBQVEsV0FBVzNDLE9BQVMsR0FHakQ4RCxFQUFRVyxVQUFVekQsVUFBWSxXQUMxQixNQUFRakIsTUFBS2EsS0FBSyxHQUFHaUUsYUFBZTlFLEtBQUthLEtBQUtrRSxjQUFpQixHQUduRWhCLEVBQVFXLFVBQVV6QyxjQUFnQixXQUM5QixPQUFRakMsS0FBS2lCLGFBQXlDLElBQTFCakIsS0FBS2EsS0FBS0MsYUFHMUNpRCxFQUFRVyxVQUFVM0MsaUJBQW1CLFdBQ2pDLE9BQVEvQixLQUFLaUIsYUFBZWpCLEtBQUthLEtBQUtDLGFBQWdCZCxLQUFLYSxLQUFLLEdBQUdpRSxhQUFlOUUsS0FBS2EsS0FBS2tFLGVBR2hHaEIsRUFBUVcsVUFBVXJFLE9BQVMsU0FBVUEsRUFBUTJFLEdBQ3pDLElBQUtBLEVBQ0QsR0FBSTNFLEVBQ0FjLEVBQVN3QyxTQUFTLFdBQWE1RCxRQUFTQyxLQUFLSCxNQUFPZ0IsS0FBTWIsS0FBS2EsV0FDNUQsQ0FDSCxHQUFJbUIsR0FBT2hDLEtBQUtnQyxNQUNoQmIsR0FBU3dDLFNBQVMsV0FBYTVELFFBQVNpQyxFQUFLbkMsTUFBT2dCLEtBQU1tQixFQUFLbkIsT0FJdkUsTUFBSVIsSUFDQUwsS0FBS2EsS0FBS1csU0FBUywyQkFFZnhCLEtBQUtnQyxRQUNMaEMsS0FBS2dDLE9BQU8zQixRQUFPLEdBQU0sSUFHeEIyRSxHQUFnQmhGLEtBQUtrQyxRQUN0QmxDLEtBQUtrQyxPQUFPN0IsUUFBTyxHQUFPLE9BRzlCOEMsR0FBaUJuRCxLQUFLSCxTQUkxQkcsS0FBS2EsS0FBS2MsWUFBWSwyQkFDbEJxRCxHQUFnQmhGLEtBQUtrQyxRQUNyQmxDLEtBQUtrQyxPQUFPN0IsUUFBTyxHQUFPLE9BRzlCOEMsR0FBaUJuRCxLQUFLSCxTQUcxQmtFLEVBQVFXLFVBQVV4QyxLQUFPLFdBQ3JCLE1BQU9oQyxHQUFTTixLQUFLSSxLQUFLSCxNQUFRLElBR3RDa0UsRUFBUVcsVUFBVTFDLEtBQU8sV0FDckIsTUFBTzlCLEdBQVNOLEtBQUtJLEtBQUtILE1BQVEsS0FJdkNvRixPQUFRM0YsT0FBT0MiLCJmaWxlIjoiZ29yaWxsYS5zY3JvbGxlci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpZiAoIXdpbmRvdy5nb3JpbGxhKSB7XHJcbiAgICB3aW5kb3cuZ29yaWxsYSA9IHt9O1xyXG59XG5cbihmdW5jdGlvbiAoJCwgZ29yaWxsYSkge1xyXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHQgKiBWQVJTXG5cdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgdmFyIHJvb3Q7XG4gICAgdmFyIG5hdmlnYXRpb247XHJcbiAgICB2YXIgaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgIHZhciBzZXR0aW5ncyA9IHtcclxuICAgICAgICB6SW5kZXg6IDAsXG4gICAgICAgIHNjcm9sbERlbGF5OiAzMDAsXG4gICAgICAgIHNob3dOYXZpZ2F0aW9uOiB0cnVlLFxuICAgICAgICBkaXNhYmxlOiBmYWxzZSxcclxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7IH1cclxuICAgIH07XG5cbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdCAqIFNFQ1RJT05TXG5cdCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgdmFyIHNlY3Rpb25zID0gW107XG5cbiAgICBzZWN0aW9ucy5hZGQgPSBmdW5jdGlvbiAoZWxlbSwgaW5kZXgsIHRvdGFsU2VjdGlvbnMpIHtcclxuICAgICAgICBzZWN0aW9ucy5wdXNoKG5ldyBTZWN0aW9uKGVsZW0sIGluZGV4LCB0b3RhbFNlY3Rpb25zIC0gaW5kZXggKyBzZXR0aW5ncy56SW5kZXgpKTtcclxuICAgIH07XG5cbiAgICBzZWN0aW9ucy5jdXJyZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBzZWN0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uaXMocm9vdC5maW5kKCcuZ29yaWxsYS1zY3JvbGxlci1hY3RpdmUnKS5maXJzdCgpKTtcclxuICAgICAgICB9KVswXTtcclxuICAgIH07XG5cbiAgICBzZWN0aW9ucy5maW5kID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgdmFyIGRvbSA9IHJvb3QuZmluZCgnLmdvcmlsbGEtc2Nyb2xsZXItc2VjdGlvbltzZWN0aW9uPScgKyBpbmRleCArICddJyk7XG5cbiAgICAgICAgaWYgKCFkb20uc2l6ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmlzKGRvbSk7XHJcbiAgICAgICAgfSlbMF07XHJcbiAgICB9O1xuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuXHQgKiBFWFBPUlRcblx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICBTY3JvbGxlciA9IGZ1bmN0aW9uIChlbGVtLCBjb25maWcpIHtcclxuICAgICAgICB0aGlzLmluaXQoJChlbGVtKSwgY29uZmlnIHx8IHt9KTtcclxuICAgIH07XG5cbiAgICBnb3JpbGxhLnNjcm9sbGVyID0gU2Nyb2xsZXI7XG4gICAgJC5mbi5nb3JpbGxhU2Nyb2xsZXIgPSBmdW5jdGlvbiAoY29uZmlnKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBnb3JpbGxhLnNjcm9sbGVyKHRoaXMsIGNvbmZpZyk7XHJcbiAgICB9O1xuXG4gICAgU2Nyb2xsZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZWxlbSwgY29uZmlnKSB7XHJcbiAgICAgICAgcm9vdCA9IGVsZW07XG4gICAgICAgICQuZXh0ZW5kKHNldHRpbmdzLCBjb25maWcpO1xuXG4gICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlcicpO1xuICAgICAgICByb290LmFkZENsYXNzKCdnb3JpbGxhLXNjcm9sbGVyLXJvb3QnKTtcblxuICAgICAgICBzZWN0aW9uc0NvbmZpZygpO1xuICAgICAgICBldmVudENvbmZpZygpO1xuXG4gICAgICAgIGlmIChzZXR0aW5ncy5zaG93TmF2aWdhdGlvbikge1xyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uQ29uZmlnKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkaXNhYmxlQ29uZmlnKCk7XHJcbiAgICB9O1xuXG4gICAgU2Nyb2xsZXIucHJvdG90eXBlLmFjdGl2ZSA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gc2VjdGlvbnMuZmluZChpbmRleCk7XG5cbiAgICAgICAgaWYgKCFjdXJyZW50KSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiR29yaWxsYSBTY3JvbGxlcjogU2VjdGlvbiBub3QgZm91bmRcIjtcclxuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudC5hY3RpdmUodHJ1ZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIFNjcm9sbGVyLnByb3RvdHlwZS5kaXNhYmxlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gaXNEaXNhYmxlZDtcclxuICAgIH07XG5cbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cdCAqIE1FVEhPRFNcblx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICBmdW5jdGlvbiBzZWN0aW9uc0NvbmZpZygpIHtcclxuICAgICAgICB2YXIgc2VjdGlvbnNEb20gPSByb290LmZpbmQoJ3NlY3Rpb24nKTtcblxuICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICBzZWN0aW9uc0RvbS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHNlY3Rpb24gPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICBpZiAoc2VjdGlvbi5maW5kKCdzZWN0aW9uJykuc2l6ZSgpID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlY3Rpb25zLmFkZChzZWN0aW9uLCBpbmRleCwgc2VjdGlvbnNEb20ubGVuZ3RoKTtcbiAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2VjdGlvbnNbMF0uYWN0aXZlKHRydWUpO1xyXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXZlbnRDb25maWcoKSB7XHJcbiAgICAgICAgdmFyIHRpbWVvdXQ7XG5cbiAgICAgICAgdmFyIGN1cnJlbnQ7XG4gICAgICAgIHZhciBpbml0aWFsU2Nyb2xsID0gbnVsbDtcbiAgICAgICAgJCh3aW5kb3cpLm1vdXNld2hlZWwoZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgIGN1cnJlbnQgPSBzZWN0aW9ucy5jdXJyZW50KCk7XG5cbiAgICAgICAgICAgIGlmIChpbml0aWFsU2Nyb2xsID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU2Nyb2xsID0gY3VycmVudC5lbGVtLnNjcm9sbFRvcCgpO1xyXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudC5kZWx0YVkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50Lmhhc1Njcm9sbCgpIHx8IGluaXRpYWxTY3JvbGwgPT09IGN1cnJlbnQuZWxlbS5zY3JvbGxUb3AoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxEb3duKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxTY3JvbGwgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSwgc2V0dGluZ3Muc2Nyb2xsRGVsYXkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnQuaGFzU2Nyb2xsKCkgfHwgaW5pdGlhbFNjcm9sbCA9PT0gY3VycmVudC5lbGVtLnNjcm9sbFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVXAoKTtcclxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGluaXRpYWxTY3JvbGwgPSBudWxsO1xyXG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5zY3JvbGxEZWxheSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZGlzYWJsZUNvbmZpZygpIHtcclxuICAgICAgICB2YXIgZW5hYmxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2dvcmlsbGEtc2Nyb2xsZXInKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc0Rpc2FibGVkKSB7XHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uc1swXS5hY3RpdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlzRGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaXNEaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnZ29yaWxsYS1zY3JvbGxlcicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB0aW1lb3V0UmVzaXplID0gbnVsbDtcclxuICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRSZXNpemUpO1xyXG4gICAgICAgICAgICB0aW1lb3V0UmVzaXplID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmRpc2FibGUgPT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmRpc2FibGUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXNldHRpbmdzLmRpc2FibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGUoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZGlzYWJsZSgpO1xyXG4gICAgICAgICAgICB9LCAxMDApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQod2luZG93KS50cmlnZ2VyKCdyZXNpemUnKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzY3JvbGxEb3duKCkge1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gc2VjdGlvbnMuY3VycmVudCgpO1xuXG4gICAgICAgIGlmIChpc0Rpc2FibGVkIHx8ICFjdXJyZW50LmlzU2Nyb2xsT25Cb3R0b20oKSB8fCAhY3VycmVudC5uZXh0KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50LmFjdGl2ZShmYWxzZSk7XHJcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY3JvbGxVcCgpIHtcclxuICAgICAgICB2YXIgY3VycmVudCA9IHNlY3Rpb25zLmN1cnJlbnQoKTtcblxuICAgICAgICBpZiAoaXNEaXNhYmxlZCB8fCAhY3VycmVudC5pc1Njcm9sbE9uVG9wKCkgfHwgIWN1cnJlbnQucHJldigpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudC5wcmV2KCkuYWN0aXZlKHRydWUpO1xyXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmF2aWdhdGlvbkNvbmZpZygpIHtcclxuICAgICAgICBuYXZpZ2F0aW9uID0gJChcIjxuYXYgY2xhc3M9J2dvcmlsbGEtc2Nyb2xsZXItbmF2aWdhdGlvbicgLz5cIik7XG4gICAgICAgIHZhciB1bCA9ICQoXCI8dWwgLz5cIik7XG5cbiAgICAgICAgc2VjdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICB2YXIgbGkgPSAkKFwiPGxpIC8+XCIpO1xuICAgICAgICAgICAgdmFyIGEgPSAkKFwiPGEgLz5cIik7XG5cbiAgICAgICAgICAgIGEuYXR0cih7XHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uOiBpdGVtLmluZGV4XHJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgcGFyZW50U2VjdGlvbiA9IGl0ZW0uZWxlbS5wYXJlbnRzKCdzZWN0aW9uJyk7XG4gICAgICAgICAgICBpZiAocGFyZW50U2VjdGlvbi5zaXplKCkgPiAwICYmIHBhcmVudFNlY3Rpb24uZmluZCgnc2VjdGlvbjpmaXJzdC1jaGlsZCcpWzBdICE9PSBpdGVtLmVsZW1bMF0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaS5hcHBlbmQoYSk7XG4gICAgICAgICAgICB1bC5hcHBlbmQobGkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBuYXZpZ2F0aW9uLmNzcyh7XHJcbiAgICAgICAgICAgICd6LWluZGV4JzogKHNlY3Rpb25zLmxlbmd0aCArIHNldHRpbmdzLnpJbmRleCkgKyAyXHJcbiAgICAgICAgfSk7XG4gICAgICAgIG5hdmlnYXRpb24uYXBwZW5kKHVsKTtcbiAgICAgICAgcm9vdC5hcHBlbmQobmF2aWdhdGlvbik7XG5cbiAgICAgICAgbmF2aWdhdGlvbi5vbignY2xpY2snLCAnYScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VjdGlvbnMuZmluZCgkKHRoaXMpLmF0dHIoJ3NlY3Rpb24nKSkuYWN0aXZlKHRydWUpO1xyXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uLmhlaWdodCh1bC5oZWlnaHQoKSk7XG4gICAgICAgICAgICBuYXZpZ2F0aW9uQ2hhbmdlKCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuYXZpZ2F0aW9uQ2hhbmdlKCkge1xyXG4gICAgICAgIGlmICghbmF2aWdhdGlvbikgcmV0dXJuO1xuXG4gICAgICAgIHZhciBjdXJyZW50ID0gc2VjdGlvbnMuY3VycmVudCgpO1xuICAgICAgICB2YXIgY3VycmVudExpbms7XG4gICAgICAgIHZhciBpbmRleCA9IGN1cnJlbnQuaW5kZXg7XG5cbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBjdXJyZW50TGluayA9IG5hdmlnYXRpb24uZmluZCgnW3NlY3Rpb249JyArIGluZGV4ICsgJ10nKTtcbiAgICAgICAgICAgIGluZGV4LS07XG5cbiAgICAgICAgICAgIGlmIChpbmRleCA8IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIkdvcmlsbGEgU2Nyb2xsZXI6IE5hdmlnYXRpb24gbGluayBub3QgZm91bmRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gd2hpbGUgKGN1cnJlbnRMaW5rLnNpemUoKSA9PT0gMCk7XG5cbiAgICAgICAgbmF2aWdhdGlvbi5yZW1vdmVDbGFzcyhmdW5jdGlvbiAoaW5kZXgsIGNzcykge1xyXG4gICAgICAgICAgICByZXR1cm4gKGNzcy5tYXRjaCgvKF58XFxzKWFjdGl2ZS1cXFMrL2cpIHx8IFtdKS5qb2luKCcgJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbmF2aWdhdGlvbi5hZGRDbGFzcyhcImFjdGl2ZS1cIiArIGN1cnJlbnQuaW5kZXgpO1xuXG4gICAgICAgIG5hdmlnYXRpb24uZmluZCgnbGknKS5yZW1vdmVDbGFzcyhcImFjdGl2ZSBhY3RpdmUtc3ViXCIpO1xuICAgICAgICBuYXZpZ2F0aW9uLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoZnVuY3Rpb24gKGluZGV4LCBjc3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChjc3MubWF0Y2goLyhefFxccylhY3RpdmUtXFxTKy9nKSB8fCBbXSkuam9pbignICcpO1xyXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBhY3RpdmVDbGFzcyA9IFwiYWN0aXZlXCI7XG5cbiAgICAgICAgaWYgKGN1cnJlbnQuaXNDaGlsZCgpKSB7XHJcbiAgICAgICAgICAgIGFjdGl2ZUNsYXNzICs9IFwiIGFjdGl2ZS1zdWIgYWN0aXZlLVwiICsgY3VycmVudC5wYXJlbnRJbmRleDtcclxuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudExpbmsucGFyZW50cygnbGknKS5hZGRDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICB9XG5cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblx0ICogU0VDVElPTlNcblx0ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICB2YXIgU2VjdGlvbiA9IGZ1bmN0aW9uIChlbGVtLCBpbmRleCwgekluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5lbGVtID0gZWxlbTtcbiAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4O1xuICAgICAgICB0aGlzLnBhcmVudEluZGV4ID0gMDtcblxuICAgICAgICBpZiAodGhpcy5pc0NoaWxkKCkpIHtcclxuICAgICAgICAgICAgZWxlbS5wYXJlbnRzKCdzZWN0aW9uJykuZmluZCgnLmdvcmlsbGEtc2Nyb2xsZXItc2VjdGlvbicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pcyhlbGVtKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50SW5kZXgrKztcclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XG5cbiAgICAgICAgZWxlbS5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlci1zZWN0aW9uIGdvcmlsbGEtc2Nyb2xsZXItc2VjdGlvbi0nICsgaW5kZXgpO1xuICAgICAgICBlbGVtLmF0dHIoJ3NlY3Rpb24nLCBpbmRleCk7XG4gICAgICAgIGVsZW0uY3NzKHtcclxuICAgICAgICAgICAgJ3otaW5kZXgnOiB6SW5kZXhcclxuICAgICAgICB9KTtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uIChlbGVtKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbVswXSA9PT0gJChlbGVtKVswXTtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5pc0NoaWxkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW0ucGFyZW50cygnc2VjdGlvbicpLnNpemUoKSA+IDA7XHJcbiAgICB9O1xuXG4gICAgU2VjdGlvbi5wcm90b3R5cGUuaGFzU2Nyb2xsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5lbGVtWzBdLnNjcm9sbEhlaWdodCAtIHRoaXMuZWxlbS5vdXRlckhlaWdodCgpKSA+IDA7XHJcbiAgICB9O1xuXG4gICAgU2VjdGlvbi5wcm90b3R5cGUuaXNTY3JvbGxPblRvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuaGFzU2Nyb2xsKCkgfHwgdGhpcy5lbGVtLnNjcm9sbFRvcCgpID09PSAwO1xyXG4gICAgfTtcblxuICAgIFNlY3Rpb24ucHJvdG90eXBlLmlzU2Nyb2xsT25Cb3R0b20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLmhhc1Njcm9sbCgpIHx8IHRoaXMuZWxlbS5zY3JvbGxUb3AoKSA+PSAodGhpcy5lbGVtWzBdLnNjcm9sbEhlaWdodCAtIHRoaXMuZWxlbS5vdXRlckhlaWdodCgpKTtcclxuICAgIH07XG5cbiAgICBTZWN0aW9uLnByb3RvdHlwZS5hY3RpdmUgPSBmdW5jdGlvbiAoYWN0aXZlLCBhcHBseUNhc2NhZGUpIHtcclxuICAgICAgICBpZiAoIWFwcGx5Q2FzY2FkZSkge1xyXG4gICAgICAgICAgICBpZiAoYWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhcImN1cnJlbnRcIiwgeyBzZWN0aW9uOiB0aGlzLmluZGV4LCBlbGVtOiB0aGlzLmVsZW0gfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV4dCA9IHRoaXMubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soXCJjdXJyZW50XCIsIHsgc2VjdGlvbjogbmV4dC5pbmRleCwgZWxlbTogbmV4dC5lbGVtIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoYWN0aXZlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbS5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlci1hY3RpdmUnKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMubmV4dCgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKS5hY3RpdmUodHJ1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFhcHBseUNhc2NhZGUgJiYgdGhpcy5wcmV2KCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJldigpLmFjdGl2ZShmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbmF2aWdhdGlvbkNoYW5nZSh0aGlzLmluZGV4KTtcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbGVtLnJlbW92ZUNsYXNzKCdnb3JpbGxhLXNjcm9sbGVyLWFjdGl2ZScpO1xuICAgICAgICBpZiAoYXBwbHlDYXNjYWRlICYmIHRoaXMucHJldigpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJldigpLmFjdGl2ZShmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxuXG4gICAgICAgIG5hdmlnYXRpb25DaGFuZ2UodGhpcy5pbmRleCk7XHJcbiAgICB9O1xuXG4gICAgU2VjdGlvbi5wcm90b3R5cGUucHJldiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmluZCh0aGlzLmluZGV4IC0gMSk7XHJcbiAgICB9O1xuXG4gICAgU2VjdGlvbi5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmluZCh0aGlzLmluZGV4ICsgMSk7XHJcbiAgICB9O1xyXG5cblxufSkoalF1ZXJ5LCB3aW5kb3cuZ29yaWxsYSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
