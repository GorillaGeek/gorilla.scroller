window.gorilla||(window.gorilla={}),function(i,e){function t(){var e=c.find("section");e.each(function(t){var n=i(this);n.find("section").size()>0||d.add(n,t,e.length)}),d[0].active(!0)}function n(){var e,t,n=null;i(window).mousewheel(function(){return clearTimeout(e),t=d.current(),null===n&&(n=t.elem.scrollTop()),event.deltaY>0?void(e=setTimeout(function(){t.hasScroll()&&n!==t.elem.scrollTop()||o(),n=null},u.scrollDelay)):void(e=setTimeout(function(){t.hasScroll()&&n!==t.elem.scrollTop()||r(),n=null},u.scrollDelay))})}function o(){var i=d.current();i.isScrollOnBottom()&&i.next()&&i.active(!1)}function r(){var i=d.current();i.isScrollOnTop()&&i.prev()&&i.prev().active(!0)}function l(){a=i("<nav class='gorilla-scroller-navigation' />");var e=i("<ul />");d.forEach(function(t){var n=i("<li />"),o=i("<a />");o.attr({section:t.index});var r=t.elem.parents("section");r.size()>0&&r.find("section:first-child")[0]!==t.elem[0]||(n.append(o),e.append(n))}),a.css({"z-index":d.length+u.zIndex}),a.append(e),c.append(a),a.on("click","a",function(){d.find(i(this).attr("section")).active(!0)}),setTimeout(function(){a.height(e.height()),s()},0)}function s(){if(a){var i,e=d.current(),t=e.index;do if(i=a.find("[section="+t+"]"),t--,-1>t)throw"Gorilla Scroller: Navigation link not found";while(0===i.size());a.find("li").removeClass("active active-sub"),a.find("li").removeClass(function(i,e){return(e.match(/(^|\s)active-\S+/g)||[]).join(" ")});var n="active";e.isChild()&&(n+=" active-sub active-"+e.parentIndex),i.parents("li").addClass(n)}}var c,a,u={zIndex:0,scrollDelay:300,showNavigation:!0},d=[];d.add=function(i,e,t){d.push(new h(i,e,t-e+u.zIndex))},d.current=function(){return d.filter(function(i){return i.is(c.find(".gorilla-scroller-active").first())})[0]},d.find=function(i){var e=c.find("#gorilla-scroller-section-"+i);return e.size()?d.filter(function(i){return i.is(e)})[0]:null},Scroller=function(e,t){this.init(i(e),t||{})},e.scroller=Scroller,i.fn.gorillaScroller=function(i){return new e.scroller(this,i)},Scroller.prototype.init=function(e,o){c=e,i.extend(u,o),i("body").addClass("gorilla-scroller"),c.addClass("gorilla-scroller-root"),t(),n(),u.showNavigation&&l()},Scroller.prototype.active=function(i){var e=d.find(i);if(!e)throw"Gorilla Scroller: Section not found";e.active(!0)};var h=function(i,e,t){this.elem=i,this.index=e,this.isChild()&&(console.log(i.parents("section"),i.parents("section").index(i)),this.parentIndex=i.parents("section").index(i)),i.addClass("gorilla-scroller-section gorilla-scroller-section-"+e),i.attr("id","gorilla-scroller-section-"+e),i.css({"z-index":t})};h.prototype.is=function(e){return this.elem[0]===i(e)[0]},h.prototype.isChild=function(){return this.elem.parents("section").size()>0},h.prototype.hasScroll=function(){return this.elem[0].scrollHeight-this.elem.height()>0},h.prototype.isScrollOnTop=function(){return!this.hasScroll()||0===this.elem.scrollTop()},h.prototype.isScrollOnBottom=function(){return!this.hasScroll()||this.elem.scrollTop()>=this.elem[0].scrollHeight-this.elem.height()},h.prototype.active=function(i,e){return i?(this.elem.addClass("gorilla-scroller-active"),this.next()&&this.next().active(!0,!0),!e&&this.prev()&&this.prev().active(!1,!0),void s(this.index)):(this.elem.removeClass("gorilla-scroller-active"),e&&this.prev()&&this.prev().active(!1,!0),void s(this.index))},h.prototype.prev=function(){return d.find(this.index-1)},h.prototype.next=function(){return d.find(this.index+1)}}(jQuery,window.gorilla);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdvcmlsbGEuc2Nyb2xsZXIuanMiXSwibmFtZXMiOlsid2luZG93IiwiZ29yaWxsYSIsIiQiLCJzZWN0aW9uc0NvbmZpZyIsInNlY3Rpb25zRG9tIiwicm9vdCIsImZpbmQiLCJlYWNoIiwiaW5kZXgiLCJzZWN0aW9uIiwidGhpcyIsInNpemUiLCJzZWN0aW9ucyIsImFkZCIsImxlbmd0aCIsImFjdGl2ZSIsImV2ZW50Q29uZmlnIiwidGltZW91dCIsImN1cnJlbnQiLCJpbml0aWFsU2Nyb2xsIiwibW91c2V3aGVlbCIsImNsZWFyVGltZW91dCIsImVsZW0iLCJzY3JvbGxUb3AiLCJldmVudCIsImRlbHRhWSIsInNldFRpbWVvdXQiLCJoYXNTY3JvbGwiLCJzY3JvbGxEb3duIiwic2V0dGluZ3MiLCJzY3JvbGxEZWxheSIsInNjcm9sbFVwIiwiaXNTY3JvbGxPbkJvdHRvbSIsIm5leHQiLCJpc1Njcm9sbE9uVG9wIiwicHJldiIsIm5hdmlnYXRpb25Db25maWciLCJuYXZpZ2F0aW9uIiwidWwiLCJmb3JFYWNoIiwiaXRlbSIsImxpIiwiYSIsImF0dHIiLCJwYXJlbnRTZWN0aW9uIiwicGFyZW50cyIsImFwcGVuZCIsImNzcyIsInotaW5kZXgiLCJ6SW5kZXgiLCJvbiIsImhlaWdodCIsIm5hdmlnYXRpb25DaGFuZ2UiLCJjdXJyZW50TGluayIsInJlbW92ZUNsYXNzIiwibWF0Y2giLCJqb2luIiwiYWN0aXZlQ2xhc3MiLCJpc0NoaWxkIiwicGFyZW50SW5kZXgiLCJhZGRDbGFzcyIsInNob3dOYXZpZ2F0aW9uIiwidG90YWxTZWN0aW9ucyIsInB1c2giLCJTZWN0aW9uIiwiZmlsdGVyIiwiaXMiLCJmaXJzdCIsImRvbSIsIlNjcm9sbGVyIiwiY29uZmlnIiwiaW5pdCIsInNjcm9sbGVyIiwiZm4iLCJnb3JpbGxhU2Nyb2xsZXIiLCJwcm90b3R5cGUiLCJleHRlbmQiLCJjb25zb2xlIiwibG9nIiwic2Nyb2xsSGVpZ2h0IiwiaXNDYXNjYWRlIiwialF1ZXJ5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QyIsImZpbGUiOiJnb3JpbGxhLnNjcm9sbGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImlmICghd2luZG93LmdvcmlsbGEpIHtcclxuICAgIHdpbmRvdy5nb3JpbGxhID0ge307XHJcbn1cclxuXHJcbihmdW5jdGlvbiAoJCwgZ29yaWxsYSkge1xyXG5cclxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqIFZBUlNcclxuICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbiAgICB2YXIgcm9vdDtcclxuICAgIHZhciBuYXZpZ2F0aW9uO1xyXG4gICAgdmFyIHNldHRpbmdzID0ge1xyXG4gICAgICAgIHpJbmRleDogMCxcclxuICAgICAgICBzY3JvbGxEZWxheTogMzAwLFxyXG4gICAgICAgIHNob3dOYXZpZ2F0aW9uOiB0cnVlXHJcbiAgICB9O1xyXG5cclxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqIFNFQ1RJT05TXHJcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gICAgdmFyIHNlY3Rpb25zID0gW107XHJcblxyXG4gICAgc2VjdGlvbnMuYWRkID0gZnVuY3Rpb24gKGVsZW0sIGluZGV4LCB0b3RhbFNlY3Rpb25zKSB7XHJcbiAgICAgICAgc2VjdGlvbnMucHVzaChuZXcgU2VjdGlvbihlbGVtLCBpbmRleCwgdG90YWxTZWN0aW9ucyAtIGluZGV4ICsgc2V0dGluZ3MuekluZGV4KSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHNlY3Rpb25zLmN1cnJlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlY3Rpb25zLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5pcyhyb290LmZpbmQoJy5nb3JpbGxhLXNjcm9sbGVyLWFjdGl2ZScpLmZpcnN0KCkpO1xyXG4gICAgICAgIH0pWzBdO1xyXG4gICAgfTtcclxuXHJcbiAgICBzZWN0aW9ucy5maW5kID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgdmFyIGRvbSA9IHJvb3QuZmluZCgnI2dvcmlsbGEtc2Nyb2xsZXItc2VjdGlvbi0nICsgaW5kZXgpO1xyXG5cclxuICAgICAgICBpZiAoIWRvbS5zaXplKCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmlzKGRvbSk7XHJcbiAgICAgICAgfSlbMF07XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqIEVYUE9SVFxyXG4gICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuICAgIFNjcm9sbGVyID0gZnVuY3Rpb24gKGVsZW0sIGNvbmZpZykge1xyXG4gICAgICAgIHRoaXMuaW5pdCgkKGVsZW0pLCBjb25maWcgfHwge30pO1xyXG4gICAgfTtcclxuXHJcbiAgICBnb3JpbGxhLnNjcm9sbGVyID0gU2Nyb2xsZXI7XHJcbiAgICAkLmZuLmdvcmlsbGFTY3JvbGxlciA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IGdvcmlsbGEuc2Nyb2xsZXIodGhpcywgY29uZmlnKTtcclxuICAgIH07XHJcblxyXG4gICAgU2Nyb2xsZXIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZWxlbSwgY29uZmlnKSB7XHJcbiAgICAgICAgcm9vdCA9IGVsZW07XHJcbiAgICAgICAgJC5leHRlbmQoc2V0dGluZ3MsIGNvbmZpZyk7XHJcblxyXG4gICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlcicpO1xyXG4gICAgICAgIHJvb3QuYWRkQ2xhc3MoJ2dvcmlsbGEtc2Nyb2xsZXItcm9vdCcpO1xyXG5cclxuICAgICAgICBzZWN0aW9uc0NvbmZpZygpO1xyXG4gICAgICAgIGV2ZW50Q29uZmlnKCk7XHJcblxyXG4gICAgICAgIGlmIChzZXR0aW5ncy5zaG93TmF2aWdhdGlvbikge1xyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uQ29uZmlnKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBTY3JvbGxlci5wcm90b3R5cGUuYWN0aXZlID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBzZWN0aW9ucy5maW5kKGluZGV4KTtcclxuXHJcbiAgICAgICAgaWYgKCFjdXJyZW50KSB7XHJcbiAgICAgICAgICAgIHRocm93IFwiR29yaWxsYSBTY3JvbGxlcjogU2VjdGlvbiBub3QgZm91bmRcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN1cnJlbnQuYWN0aXZlKHRydWUpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgKiBNRVRIT0RTXHJcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gICAgZnVuY3Rpb24gc2VjdGlvbnNDb25maWcoKSB7XHJcbiAgICAgICAgdmFyIHNlY3Rpb25zRG9tID0gcm9vdC5maW5kKCdzZWN0aW9uJyk7XHJcbiAgICAgICAgc2VjdGlvbnNEb20uZWFjaChmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgdmFyIHNlY3Rpb24gPSAkKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlY3Rpb24uZmluZCgnc2VjdGlvbicpLnNpemUoKSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2VjdGlvbnMuYWRkKHNlY3Rpb24sIGluZGV4LCBzZWN0aW9uc0RvbS5sZW5ndGgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzZWN0aW9uc1swXS5hY3RpdmUodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZXZlbnRDb25maWcoKSB7XHJcbiAgICAgICAgdmFyIHRpbWVvdXQ7XHJcblxyXG4gICAgICAgIHZhciBjdXJyZW50O1xyXG4gICAgICAgIHZhciBpbml0aWFsU2Nyb2xsID0gbnVsbDtcclxuICAgICAgICAkKHdpbmRvdykubW91c2V3aGVlbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuICAgICAgICAgICAgY3VycmVudCA9IHNlY3Rpb25zLmN1cnJlbnQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbml0aWFsU2Nyb2xsID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpbml0aWFsU2Nyb2xsID0gY3VycmVudC5lbGVtLnNjcm9sbFRvcCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGVsdGFZID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudC5oYXNTY3JvbGwoKSB8fCBpbml0aWFsU2Nyb2xsID09PSBjdXJyZW50LmVsZW0uc2Nyb2xsVG9wKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsRG93bigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9LCBzZXR0aW5ncy5zY3JvbGxEZWxheSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudC5oYXNTY3JvbGwoKSB8fCBpbml0aWFsU2Nyb2xsID09PSBjdXJyZW50LmVsZW0uc2Nyb2xsVG9wKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxVcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGluaXRpYWxTY3JvbGwgPSBudWxsO1xyXG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5zY3JvbGxEZWxheSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2Nyb2xsRG93bigpIHtcclxuICAgICAgICB2YXIgY3VycmVudCA9IHNlY3Rpb25zLmN1cnJlbnQoKTtcclxuXHJcbiAgICAgICAgaWYgKCFjdXJyZW50LmlzU2Nyb2xsT25Cb3R0b20oKSB8fCAhY3VycmVudC5uZXh0KCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3VycmVudC5hY3RpdmUoZmFsc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNjcm9sbFVwKCkge1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gc2VjdGlvbnMuY3VycmVudCgpO1xyXG5cclxuICAgICAgICBpZiAoIWN1cnJlbnQuaXNTY3JvbGxPblRvcCgpIHx8ICFjdXJyZW50LnByZXYoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdXJyZW50LnByZXYoKS5hY3RpdmUodHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbmF2aWdhdGlvbkNvbmZpZygpIHtcclxuICAgICAgICBuYXZpZ2F0aW9uID0gJChcIjxuYXYgY2xhc3M9J2dvcmlsbGEtc2Nyb2xsZXItbmF2aWdhdGlvbicgLz5cIik7XHJcbiAgICAgICAgdmFyIHVsID0gJChcIjx1bCAvPlwiKTtcclxuXHJcbiAgICAgICAgc2VjdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICB2YXIgbGkgPSAkKFwiPGxpIC8+XCIpO1xyXG4gICAgICAgICAgICB2YXIgYSA9ICQoXCI8YSAvPlwiKTtcclxuXHJcbiAgICAgICAgICAgIGEuYXR0cih7IHNlY3Rpb246IGl0ZW0uaW5kZXggfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcGFyZW50U2VjdGlvbiA9IGl0ZW0uZWxlbS5wYXJlbnRzKCdzZWN0aW9uJyk7XHJcbiAgICAgICAgICAgIGlmIChwYXJlbnRTZWN0aW9uLnNpemUoKSA+IDAgJiYgcGFyZW50U2VjdGlvbi5maW5kKCdzZWN0aW9uOmZpcnN0LWNoaWxkJylbMF0gIT09IGl0ZW0uZWxlbVswXSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsaS5hcHBlbmQoYSk7XHJcbiAgICAgICAgICAgIHVsLmFwcGVuZChsaSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5hdmlnYXRpb24uY3NzKHsgJ3otaW5kZXgnOiBzZWN0aW9ucy5sZW5ndGggKyBzZXR0aW5ncy56SW5kZXggfSk7XHJcbiAgICAgICAgbmF2aWdhdGlvbi5hcHBlbmQodWwpO1xyXG4gICAgICAgIHJvb3QuYXBwZW5kKG5hdmlnYXRpb24pO1xyXG5cclxuICAgICAgICBuYXZpZ2F0aW9uLm9uKCdjbGljaycsICdhJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWN0aW9ucy5maW5kKCQodGhpcykuYXR0cignc2VjdGlvbicpKS5hY3RpdmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uLmhlaWdodCh1bC5oZWlnaHQoKSk7XHJcbiAgICAgICAgICAgIG5hdmlnYXRpb25DaGFuZ2UoKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBuYXZpZ2F0aW9uQ2hhbmdlKCkge1xyXG4gICAgICAgIGlmICghbmF2aWdhdGlvbikgcmV0dXJuO1xyXG5cclxuICAgICAgICB2YXIgY3VycmVudCA9IHNlY3Rpb25zLmN1cnJlbnQoKTtcclxuICAgICAgICB2YXIgY3VycmVudExpbms7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gY3VycmVudC5pbmRleDtcclxuXHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBjdXJyZW50TGluayA9IG5hdmlnYXRpb24uZmluZCgnW3NlY3Rpb249JyArIGluZGV4ICsgJ10nKTtcclxuICAgICAgICAgICAgaW5kZXgtLTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbmRleCA8IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBcIkdvcmlsbGEgU2Nyb2xsZXI6IE5hdmlnYXRpb24gbGluayBub3QgZm91bmRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gd2hpbGUgKGN1cnJlbnRMaW5rLnNpemUoKSA9PT0gMCk7XHJcblxyXG5cclxuICAgICAgICBuYXZpZ2F0aW9uLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoXCJhY3RpdmUgYWN0aXZlLXN1YlwiKTtcclxuICAgICAgICBuYXZpZ2F0aW9uLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoZnVuY3Rpb24gKGluZGV4LCBjc3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuIChjc3MubWF0Y2goLyhefFxccylhY3RpdmUtXFxTKy9nKSB8fCBbXSkuam9pbignICcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB2YXIgYWN0aXZlQ2xhc3MgPSBcImFjdGl2ZVwiO1xyXG5cclxuICAgICAgICBpZiAoY3VycmVudC5pc0NoaWxkKCkpIHtcclxuICAgICAgICAgICAgYWN0aXZlQ2xhc3MgKz0gXCIgYWN0aXZlLXN1YiBhY3RpdmUtXCIgKyBjdXJyZW50LnBhcmVudEluZGV4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3VycmVudExpbmsucGFyZW50cygnbGknKS5hZGRDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAqIFNFQ1RJT05TXHJcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG4gICAgdmFyIFNlY3Rpb24gPSBmdW5jdGlvbiAoZWxlbSwgaW5kZXgsIHpJbmRleCkge1xyXG4gICAgICAgIHRoaXMuZWxlbSA9IGVsZW07XHJcbiAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pc0NoaWxkKCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZWxlbS5wYXJlbnRzKCdzZWN0aW9uJyksIGVsZW0ucGFyZW50cygnc2VjdGlvbicpLmluZGV4KGVsZW0pKTtcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnRJbmRleCA9IGVsZW0ucGFyZW50cygnc2VjdGlvbicpLmluZGV4KGVsZW0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWxlbS5hZGRDbGFzcygnZ29yaWxsYS1zY3JvbGxlci1zZWN0aW9uIGdvcmlsbGEtc2Nyb2xsZXItc2VjdGlvbi0nICsgaW5kZXgpO1xyXG4gICAgICAgIGVsZW0uYXR0cignaWQnLCAnZ29yaWxsYS1zY3JvbGxlci1zZWN0aW9uLScgKyBpbmRleCk7XHJcbiAgICAgICAgZWxlbS5jc3MoeyAnei1pbmRleCc6IHpJbmRleCB9KTtcclxuICAgIH07XHJcblxyXG4gICAgU2VjdGlvbi5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbiAoZWxlbSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1bMF0gPT09ICQoZWxlbSlbMF07XHJcbiAgICB9O1xyXG5cclxuICAgIFNlY3Rpb24ucHJvdG90eXBlLmlzQ2hpbGQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbS5wYXJlbnRzKCdzZWN0aW9uJykuc2l6ZSgpID4gMDtcclxuICAgIH1cclxuXHJcbiAgICBTZWN0aW9uLnByb3RvdHlwZS5oYXNTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLmVsZW1bMF0uc2Nyb2xsSGVpZ2h0IC0gdGhpcy5lbGVtLmhlaWdodCgpKSA+IDA7XHJcbiAgICB9O1xyXG5cclxuICAgIFNlY3Rpb24ucHJvdG90eXBlLmlzU2Nyb2xsT25Ub3AgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLmhhc1Njcm9sbCgpIHx8IHRoaXMuZWxlbS5zY3JvbGxUb3AoKSA9PT0gMDtcclxuICAgIH07XHJcblxyXG4gICAgU2VjdGlvbi5wcm90b3R5cGUuaXNTY3JvbGxPbkJvdHRvbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMuaGFzU2Nyb2xsKCkgfHwgdGhpcy5lbGVtLnNjcm9sbFRvcCgpID49ICh0aGlzLmVsZW1bMF0uc2Nyb2xsSGVpZ2h0IC0gdGhpcy5lbGVtLmhlaWdodCgpKTtcclxuICAgIH07XHJcblxyXG4gICAgU2VjdGlvbi5wcm90b3R5cGUuYWN0aXZlID0gZnVuY3Rpb24gKGFjdGl2ZSwgaXNDYXNjYWRlKSB7XHJcbiAgICAgICAgaWYgKGFjdGl2ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW0uYWRkQ2xhc3MoJ2dvcmlsbGEtc2Nyb2xsZXItYWN0aXZlJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5uZXh0KCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpLmFjdGl2ZSh0cnVlLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFpc0Nhc2NhZGUgJiYgdGhpcy5wcmV2KCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJldigpLmFjdGl2ZShmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG5hdmlnYXRpb25DaGFuZ2UodGhpcy5pbmRleCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuZWxlbS5yZW1vdmVDbGFzcygnZ29yaWxsYS1zY3JvbGxlci1hY3RpdmUnKTtcclxuICAgICAgICBpZiAoaXNDYXNjYWRlICYmIHRoaXMucHJldigpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJldigpLmFjdGl2ZShmYWxzZSwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuYXZpZ2F0aW9uQ2hhbmdlKHRoaXMuaW5kZXgpO1xyXG4gICAgfTtcclxuXHJcbiAgICBTZWN0aW9uLnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBzZWN0aW9ucy5maW5kKHRoaXMuaW5kZXggLSAxKTtcclxuICAgIH07XHJcblxyXG4gICAgU2VjdGlvbi5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gc2VjdGlvbnMuZmluZCh0aGlzLmluZGV4ICsgMSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbn0pKGpRdWVyeSwgd2luZG93LmdvcmlsbGEpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
